<body>
    <p>
        <a href="/">
            <img alt="intervolga.ru" src="/assets/logo/logo.svg"/>
        </a>
    </p>
    <p>
        <a href="tel:+74956485790">
            +7 495 648 57 90
        </a>
    </p>
    <ul>
        <li>
            <p>
                <a href="/dev/">
                    Разработка на Битрикс
                </a>
            </p>
        </li>
        <li>
            <p>
                <a href="/bitrix24/">
                    Битрикс24
                </a>
            </p>
        </li>
        <li>
            <p>
                <a href="/1c/">
                    1С
                </a>
            </p>
        </li>
        <li>
            <p>
                <a href="/adv/">
                    Интернет-маркетинг
                </a>
            </p>
        </li>
        <li>
            <p>
                <a href="/vacancy/">
                    Вакансии
                </a>
            </p>
        </li>
        <li>
            <p>
                <a href="/import/">
                    Импортозамещение
                </a>
            </p>
        </li>
        <li>
            <p>
                <a href="/industries/">
                    Отрасли
                </a>
            </p>
        </li>
        <li>
            <p>
                <a href="/web-integration/">
                    Кто мы
                </a>
            </p>
        </li>
        <li>
            <p>
                <a href="/cases/">
                    Крупные проекты
                </a>
            </p>
        </li>
        <li>
            <p>
                <a href="/portfolio/">
                    Портфолио
                </a>
            </p>
        </li>
        <li>
            <p>
                <a href="/blog/">
                    Блог
                </a>
            </p>
        </li>
        <li>
            <p>
                <a href="/contacts/">
                    Контакты
                </a>
            </p>
        </li>
    </ul>
    <p>
        <img alt="" src="https://www.intervolga.ru/upload/resize_cache/iblock/2fc/1600_600_2/pvg8nsj6syo2ppfkq69tuepi3l3fxmsx.png.webp?w=1920"/>
    </p>
    <ol>
        <li>
            <a href="/" title="Главная">
                Главная
            </a>
        </li>
        <li>
            <ul>
                <li>
                </li>
            </ul>
        </li>
        <li>
            <a href="/blog/" title="Блог">
                Блог
            </a>
        </li>
        <li>
            <ul>
                <li>
                </li>
            </ul>
        </li>
        <li>
            <a href="/blog/projects/" title="Веб-Проекты">
                Веб-Проекты
            </a>
        </li>
        <li>
            <ul>
                <li>
                </li>
            </ul>
        </li>
        <li>
            <a href="/blog/projects/vyzhimaem-maksimum-skorosti-iz-php/" title="Выжимаем максимум скорости из PHP">
                Выжимаем максимум скорости из PHP
            </a>
        </li>
    </ol>
    <h1>
        Выжимаем максимум скорости из PHP
    </h1>
    <p>
        <a href="/people/artem_s/">
            <img alt="" src="/upload/resize_cache/iblock/af4/60_60_2/af457880b41bf93ca1ef54451d4a5014.png.webp"/>
            Артём Ш.
        </a>
    </p>
    <p>
        <a href="/subscribe/">
            Подписаться
        </a>
    </p>
    <ul>
        <li>
            <a href="#section0">
                О чем статья
            </a>
        </li>
        <li>
            <a href="#section1">
                Приложения для запуска php: 30 лет эволюции
            </a>
            <ul>
                <li>
                    <a href="#section2">
                        1. Apache + mod_php
                    </a>
                </li>
                <li>
                    <a href="#section3">
                        2. PHP-FPM (PHP FastCGI Process Manager)
                    </a>
                </li>
                <li>
                    <a href="#section4">
                        3. PHP-PM (PHP Process Manager)
                    </a>
                </li>
                <li>
                    <a href="#section5">
                        4. FrankenPHP
                    </a>
                </li>
                <li>
                    <a href="#section6">
                        5. RoadRunner
                    </a>
                </li>
                <li>
                    <a href="#section7">
                        6. Swoole
                    </a>
                </li>
                <li>
                    <a href="#section8">
                        7. NGINX Unit
                    </a>
                </li>
            </ul>
        </li>
        <li>
            <a href="#section9">
                Сравнение скорости приложений
            </a>
        </li>
        <li>
            <a href="#section10">
                Выводы
            </a>
        </li>
    </ul>
    <h2>
        О чем статья
    </h2>
    <p>
        Когда дело доходит до запуска PHP-приложений, выбор правильного веб-сервера критически важен. Чтобы достоверно оценить производительность популярных серверов мы тестировали их не на синтетических, а на реальных данных. Мы не хотели составлять свой рейтинг веб-серверов для запуска php-приложений. Нашей задачей было показать условия, при которых тот или иной веб-сервер продемонстрирует лучшие результаты.
    </p>
    <h2>
        Приложения для запуска php: 30 лет эволюции
    </h2>
    <p>
        В начале был CGI. Это была одна из первых технологий для запуска серверных скриптов, появившаяся в 90-х. CGI поддерживает разные языки, что делает этот интерфейс весьма универсальным, но со своими недостатками. Например, на каждый запрос сервер создает отдельный процесс для каждого CGI-скрипта, что приводит к перерасходу системных ресурсов и сильно сказывается на производительности и скорости ответа сервера. Известной проблемой также является запуск скрипта с правами пользователя веб-сервера. Т.е. при неправильной настройке сервера CGI-скрипт может получить доступ не только к файлам и ресурсам другого приложения, но и к логам и конфигурации сервера, что создает потенциальную уязвимость.
    </p>
    <p>
        Чтобы решить эти проблемы, был разработан Apache и модуль mod_php, который позволил запускать PHP-код непосредственно внутри веб-сервера и настроить индивидуальные права доступа к файлам для каждого хоста. Хотя на каждый запрос по-прежнему создавался отдельный процесс, часть данных кэшировалась, что существенно ускоряло выполнение по сравнению с CGI. Это давало значительный прирост в скорости.
    </p>
    <p>
        Apache + mod_php стал популярен благодаря своей простоте конфигурации. Apache до сих пор является одним из популярных веб-серверов для web и часто используется для создания чего-то на скорую руку и без особого конфигурирования.
    </p>
    <p>
        <img alt="Статистика популярности веб-серверов.png" src="/upload/medialibrary/7c4/2t95r2vbbk1b3cq4en4sqx15w19pc2py.png.webp"/>
    </p>
    <p>
        <em>
            Популярность и доли рынка
            <a href="http://w3techs.com/technologies/overview/web_server">
                web-серверов
            </a>
            .
        </em>
    </p>
    <p>
        Но использовать Apache для отдачи статики не лучшее решение: даже для получения картинки будет использован «тяжелый» (со всеми модулями вроде mod_php) обработчик.
    </p>
    <p>
        Хорошей практикой считается использование Apache вместе с Nginx. Nginx эффективно справляется с отдачей статики, а запросы требующие выполнения php кода перенаправляет на Apache. Это значительно уменьшает потребление памяти и повышает скорость обработки запросов.
    </p>
    <p>
        <img alt="Схема обработки запроса сервером.png" src="/upload/medialibrary/b5a/y32j3d035dznfxaaex6tqbk2ceqa4xdo.png.webp"/>
    </p>
    <p>
        <em>
            Схема обработки запроса web-сервером.
        </em>
    </p>
    <p>
        Связка Nginx и Apache с mod_php дает значительный прирост производительности, но модуль mod_php имеет узкое место: он запускает интерпретатор php в контексте каждого процесса Apache, что сильно увеличивает использование ресурсов.
    </p>
    <p>
        Для более эффективного выполнения php был разработан PHP-FPM (FastCGI Process Manager) — это расширенная версия FastCGI, разработанная для увеличения производительности и надежности в средах с высокой нагрузкой. В отличие от mod_php, FPM запускает пул рабочих процессов, которые обслуживают запросы независимо от самого веб-сервера. Нужно иметь в виду, что для получения максимального быстродействия требуется детальная настройка. Также стоит учесть что некоторые CMS (WordPress, 1С-Битрикс: Управление сайтом) потребуют дополнительного конфигурирования так как часть правил хранится в файлах .htaccess (т.е. рассчитаны на запуск именно через Apache).
    </p>
    <p>
        Можно ли что то еще сделать для ускорения работы PHP-скриптов? Этот вопрос задал себе не один разработчик. В поисках решения были найдены технологии, которые кардинально изменили подход к обработке запросов:
    </p>
    <ul>
        <li>
            Поддержка долгоживущих процессов. В отличии от традиционного подхода где приложение инициализируется каждый раз при новом запросе, можно один раз загрузить все приложение в память и использовать для обработки входящих запросов.
        </li>
        <li>
            HTTP-сервер на уровне приложения. Устраняет дополнительный слой между сервером и приложением, снижая накладные расходы.
        </li>
        <li>
            Многопоточность. Позволяет приложениям обрабатывать больше запросов одновременно в рамках одного процесса.
        </li>
        <li>
            Минимизация накладных расходов на взаимодействие с FastCGI. Убирая взаимодействие с FastCGI и работая с php кодом нативно мы устраняем накладные расходы на обработку каждого запроса.
        </li>
    </ul>
    <p>
        Рассмотрим плюсы и минусы некоторых способов запуска php приложений:
    </p>
    <h3>
        1. Apache + mod_php
    </h3>
    <p>
        Создатель: Apache Software Foundation. Написан на C.
    </p>
    <p>
        Плюсы:
    </p>
    <ul>
        <li>
            Лёгкость настройки. mod_php включен в в стандартную сборку apache.
        </li>
        <li>
            Стабильность. Решение проверено временем и имеет большую базу готовых проектов.
        </li>
    </ul>
    <p>
        Минусы:
    </p>
    <ul>
        <li>
            Ресурсоемкость. Модуль загружается внутри каждого процесса Apache, что сильно влияет на производительность.
        </li>
        <li>
            Большое увеличение потребляемых ресурсов при высоких нагрузках.
        </li>
        <li>
            Отсутствие гибкости. Не позволяет тонко настроить конфигурацию для каждого виртуального хоста или разделение ресурсов между процессами.
        </li>
    </ul>
    <h3>
        2. PHP-FPM (PHP FastCGI Process Manager)
    </h3>
    <p>
        Создатель: Андрей Павлин. Написан на C.
    </p>
    <p>
        Плюсы:
    </p>
    <ul>
        <li>
            Стал официальной частью PHP, начиная с версии 5.3.
        </li>
        <li>
            №2 в списке популярных способов запуска PHP-приложений.
        </li>
        <li>
            Обладает неплохой производительностью за счет масштабирования пула воркеров.
        </li>
        <li>
            Возможность гибкой настройки пула.
        </li>
        <li>
            Больше возможностей для отладки, включая лог медленных запросов.
        </li>
    </ul>
    <p>
        Минусы:
    </p>
    <ul>
        <li>
            Более сложная настройка по сравнению с Apache(mod_php).
        </li>
        <li>
            Необходимо настроить взаимодействие с веб-сервером (Nginx).
        </li>
        <li>
            Ресурсоемкость: Каждый запрос обрабатывается отдельным PHP-процессом, что увеличивает расход оперативной памяти при высокой нагрузке. Также присутствуют накладные расходы из-за коммуникации через FastCGI.
        </li>
    </ul>
    <h3>
        3. PHP-PM (PHP Process Manager)
    </h3>
    <p>
        Создатель: Марк Шличтенмайер. Написан на PHP.
    </p>
    <p>
        Плюсы:
    </p>
    <ul>
        <li>
            Поддержка долгоживущих процессов. Вследствие чего производительность лучше чем у php-fpm.
        </li>
        <li>
            Асинхронная обработка. PHP-PM использует ReactPHP для обеспечения асинхронности, что значительно ускоряет обработку запросов.
        </li>
        <li>
            Автоматическая перезагрузка при изменении кода.
        </li>
    </ul>
    <p>
        Минусы:
    </p>
    <ul>
        <li>
            Необходимо следить за памятью.
        </li>
        <li>
            Требует более глубокого понимания работы асинхронного PHP.
        </li>
        <li>
            Небольшое сообщество.
        </li>
        <li>
            Меньше совместимости: Не поддерживает все библиотеки и расширения, использующие синхронные механизмы, такие как PDO или CURL, которые по умолчанию работают в синхронном режиме.
        </li>
    </ul>
    <h3>
        4. FrankenPHP
    </h3>
    <p>
        Создатель: Кевин Дюнглас. Написан на Go.
    </p>
    <p>
        Плюсы:
    </p>
    <ul>
        <li>
            Поддержка долгоживущих процессов.
        </li>
        <li>
            Нет необходимости в отдельном веб-сервере.
        </li>
        <li>
            Поддерживает асинхронную обработку запросов.
        </li>
        <li>
            Поддержка WebSocket и длительных соединений.
        </li>
        <li>
            Поддерживается в laravel octane (библиотека позволяющая одной командой установить Swoole, RoadRunner или FrankenPHP, без необходимости писать код воркера) (
            <a href="https://github.com/laravel/octane">
                https://github.com/laravel/octane
            </a>
            ).
        </li>
    </ul>
    <p>
        Минусы:
    </p>
    <ul>
        <li>
            Необходимо следить за памятью.
        </li>
        <li>
            Необходимо перезапускать при изменении кода.
        </li>
        <li>
            Требует более глубокого понимания работы асинхронного PHP.
        </li>
        <li>
            Небольшое сообщество.
        </li>
        <li>
            Без использования laravel octane необходимо написать код для воркера.
        </li>
        <li>
            Сложная настройка. Требует более сложной настройки и внедрения в существующие проекты по сравнению с традиционными решениями например php-fpm.
        </li>
    </ul>
    <h3>
        5. RoadRunner
    </h3>
    <p>
        Создатель: Spiral Scout. Написан на Go.
    </p>
    <p>
        Плюсы:
    </p>
    <ul>
        <li>
            Поддержка долгоживущих процессов.
        </li>
        <li>
            Нет необходимости в отдельном веб-сервере.
        </li>
        <li>
            Асинхронность и многопоточность: поддерживает асинхронные задачи.
        </li>
        <li>
            WebSocket и gRPC: Поддерживает WebSocket, gRPC и очереди для построения реальных асинхронных приложений.
        </li>
        <li>
            Поддерживается в laravel octane.
        </li>
    </ul>
    <p>
        Минусы:
    </p>
    <ul>
        <li>
            Необходимо следить за памятью.
        </li>
        <li>
            Необходимо перезапускать при изменении кода.
        </li>
        <li>
            Требует более глубокого понимания работы асинхронного PHP.
        </li>
        <li>
            Небольшое сообщество.
        </li>
        <li>
            Без использования laravel octane необходимо написать код для воркера.
        </li>
        <li>
            Сложная настройка.
        </li>
    </ul>
    <h3>
        6. Swoole
    </h3>
    <p>
        Создатель: Swoole Team. Написан на C.
    </p>
    <p>
        Плюсы:
    </p>
    <ul>
        <li>
            Поддержка долгоживущих процессов.
        </li>
        <li>
            Нет необходимости в отдельном веб-сервере.
        </li>
        <li>
            Поддерживает асинхронный ввод/вывод и корутины, и может обрабатывать высоко-конкурентные запросы.
        </li>
        <li>
            Поддержка множества сетевых протоколов, таймеров, управления процессами, управления памятью и других функций, отвечающих различным потребностям разработки.
        </li>
        <li>
            Поддерживается в laravel octane.
        </li>
    </ul>
    <p>
        Минусы:
    </p>
    <ul>
        <li>
            Необходимо следить за памятью.
        </li>
        <li>
            Необходимо перезапускать при изменении кода.
        </li>
        <li>
            Требует более глубокого понимания работы асинхронного PHP.
        </li>
        <li>
            Небольшое сообщество.
        </li>
        <li>
            Без использования laravel octane необходимо написать код для воркера.
        </li>
        <li>
            Сложная настройка.
        </li>
    </ul>
    <h3>
        7. NGINX Unit
    </h3>
    <p>
        Создатель: NGINX. Написан на C.
    </p>
    <p>
        Плюсы:
    </p>
    <ul>
        <li>
            Unit поддерживает не только PHP, но и другие языки, такие как Python, Go, Perl и Ruby.
        </li>
        <li>
            Поддерживает динамическую смену конфигурации без перезапуска сервера.
        </li>
        <li>
            Можно запускать несколько приложений одновременно, что удобно для микросервисов.
        </li>
        <li>
            Минимизирует время простоя и облегчает управление конфигурациями.
        </li>
        <li>
            Не требуется изменять приложение как в случае с долгоживущими процессами.
        </li>
    </ul>
    <p>
        Минусы:
    </p>
    <ul>
        <li>
            Меньшая производительность по сравнению с решениями для долгоживущих процессов.
        </li>
        <li>
            Небольшое сообщество: Unit менее популярен по сравнению с традиционными решениями вроде PHP-FPM.
        </li>
        <li>
            Ограниченные возможности для асинхронности: Хотя Unit поддерживает несколько языков и конфигураций, он все еще уступает в плане асинхронных возможностей таким решениям, как Swoole или RoadRunner.
        </li>
    </ul>
    <h2>
        Сравнение скорости приложений
    </h2>
    <p>
        На тему сравнения скорости приложений для запуска PHP написано множество статей и проведена уйма тестов. Например:
    </p>
    <ol>
        <li>
            <a href="https://habr.com/ru/articles/431818/">
                Сравниваем PHP FPM, PHP PPM, Nginx Unit, React PHP и RoadRunner
            </a>
        </li>
        <li>
            <a href="https://dev.to/dimdev/performance-benchmark-of-php-runtimes-2lmc">
                Тест производительности во время выполнения PHP
            </a>
        </li>
        <li>
            <a href="https://yarnaudov.com/mod-php-vs-php-fpm-performance-benchmark.html">
                Mo
            </a>
            <a href="https://yarnaudov.com/mod-php-vs-php-fpm-performance-benchmark.html">
                d_php vs php-fpm Performance Benchmark [Surprising Results]
            </a>
        </li>
        <li>
            <a href="https://www.p4tchwork.de/apache-php-system-resource-usage/">
                Apache & PHP system resource usage | mpm_prefork + mod_php vs. mpm_event + php-fpm
            </a>
        </li>
        <li>
            <a href="https://habr.com/ru/articles/646397/">
                Comparing PHP-FPM, NGINX Unit, and Laravel Octane
            </a>
        </li>
    </ol>
    <p>
        Однако большая часть таких тестов являются сильно синтетическими, т.е. тестируемые проекты мало похожи на то, с чем вы в итоге будете иметь дело (например, первая статья, где сервер отвечает json`ом без запросов к БД или вторая, где тестируется phpinfo). Чтобы сделать тесты более реалистичным мы взяли интернет-магазин на базе Laravel (Laravel Framework 10.41.0) — Bagisto (v2.2.2). Сгенерировали 5000 товаров и настроили его в соответствии с инструкциями по развертыванию (включен кэш и отключен различный дебаг).
    </p>
    <p>
        <strong>
            Env-переменные
        </strong>
    </p>
    <table>
        <thead>
            <tr>
                <th>
                </th>
                <th>
                </th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>
                    Параметр
                </td>
                <td>
                    Значение
                </td>
            </tr>
            <tr>
                <td>
                    APP_ENV
                </td>
                <td>
                    production
                </td>
            </tr>
            <tr>
                <td>
                    APP_DEBUG
                </td>
                <td>
                    false
                </td>
            </tr>
            <tr>
                <td>
                    RESPONSE_CACHE_ENABLED
                </td>
                <td>
                    true
                </td>
            </tr>
        </tbody>
    </table>
    <p>
        <strong>
            Кэширование конфигов и роутов
        </strong>
    </p>
    <ul>
        <li>
            «php artisan optimize»
        </li>
    </ul>
    <p>
        <strong>
            Среда тестирования
        </strong>
    </p>
    <table>
        <thead>
            <tr>
                <th>
                </th>
                <th>
                </th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>
                    Virtualization
                </td>
                <td>
                    WSL
                </td>
            </tr>
            <tr>
                <td>
                    CPU
                </td>
                <td>
                    8 cores (2.8GHz)
                </td>
            </tr>
            <tr>
                <td>
                    RAM
                </td>
                <td>
                    8Gb
                </td>
            </tr>
            <tr>
                <td>
                    OS
                </td>
                <td>
                    Ubuntu
                </td>
            </tr>
        </tbody>
    </table>
    <p>
        <strong>
            Конфигурация MySQL
        </strong>
    </p>
    <table>
        <thead>
            <tr>
                <th>
                </th>
                <th>
                </th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>
                    Параметр
                </td>
                <td>
                    Значение
                </td>
            </tr>
            <tr>
                <td>
                    tmp_table_size
                </td>
                <td>
                    512M
                </td>
            </tr>
            <tr>
                <td>
                    max_heap_table_size
                </td>
                <td>
                    512M
                </td>
            </tr>
            <tr>
                <td>
                    sort_buffer_size
                </td>
                <td>
                    64M
                </td>
            </tr>
            <tr>
                <td>
                    read_rnd_buffer_size
                </td>
                <td>
                    1M
                </td>
            </tr>
            <tr>
                <td>
                    max_connections
                </td>
                <td>
                    500
                </td>
            </tr>
            <tr>
                <td>
                    max_user_connections
                </td>
                <td>
                    500
                </td>
            </tr>
        </tbody>
    </table>
    <p>
        Все контейнеры и результаты замеров опубликованы в нашем
        <a href="https://github.com/intervolga/php-runner-speed">
            GitHub
        </a>
        .
    </p>
    <p>
        <strong>
            Инструменты тестирования
        </strong>
    </p>
    <p>
        Само тестирование проводилось с помощью Yandex Tank при следующей конфигурации:
    </p>
    <pre><code>  load_profile:
    load_type: rps
    schedule: line(10, 300, 60s) const(100, 60s)
  instances: 300
</code></pre>
    <p>
        В данном случае мы явно ограничивает Yandex Tank в количестве инстансов, чтобы не добиться появления 110 кодов ответов, а проверить какой RPS способен выдавать сервер в заданной конфигурации.
    </p>
    <p>
        В рамках тестирования мы проверяли следующие сервера приложений:
    </p>
    <ul>
        <li>
            Apache(mod_php)
        </li>
        <li>
            PHP-FPM
        </li>
        <li>
            FrankenPHP
        </li>
        <li>
            RoadRunner
        </li>
        <li>
            Swoole
        </li>
        <li>
            Nginx-UNIT
        </li>
    </ul>
    <p>
        PHP-PM не участвовал в сравнении так как последний релиз был в 2022 и сейчас часть классов из пакета React\Http не совместима с новыми версиями Psr\Http.
    </p>
    <p>
        <strong>
            Общие результаты тестирования
        </strong>
    </p>
    <table>
        <thead>
            <tr>
                <th>
                </th>
                <th>
                </th>
                <th>
                </th>
                <th>
                </th>
                <th>
                </th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>
                    Тип
                </td>
                <td>
                    AVG CPU (%)
                </td>
                <td>
                    AVG RAM (mb)
                </td>
                <td>
                    AVG RPS
                </td>
                <td>
                    Результат yandex tank
                </td>
            </tr>
            <tr>
                <td>
                    Swoole
                </td>
                <td>
                    45
                </td>
                <td>
                    752
                </td>
                <td>
                    152.5
                </td>
                <td>
                    <a href="https://clck.ru/3DbnXQ">
                        https://clck.ru/3DbnXQ
                    </a>
                </td>
            </tr>
            <tr>
                <td>
                    FrankenPHP
                </td>
                <td>
                    68
                </td>
                <td>
                    954
                </td>
                <td>
                    140.7
                </td>
                <td>
                    <a href="https://clck.ru/3DbqLi">
                        https://clck.ru/3DbqLi
                    </a>
                </td>
            </tr>
            <tr>
                <td>
                    RoadRunner
                </td>
                <td>
                    60
                </td>
                <td>
                    638
                </td>
                <td>
                    131.5
                </td>
                <td>
                    <a href="https://clck.ru/3DbpkP">
                        https://clck.ru/3DbpkP
                    </a>
                </td>
            </tr>
            <tr>
                <td>
                    Nginx Unit
                </td>
                <td>
                    87
                </td>
                <td>
                    2384
                </td>
                <td>
                    39.1
                </td>
                <td>
                    <a href="https://clck.ru/3DbpLp">
                        https://clck.ru/3DbpLp
                    </a>
                </td>
            </tr>
            <tr>
                <td>
                    Apache+mod_php
                </td>
                <td>
                    89
                </td>
                <td>
                    5277
                </td>
                <td>
                    37.5
                </td>
                <td>
                    <a href="https://clck.ru/3DboQw">
                        https://clck.ru/3DboQw
                    </a>
                </td>
            </tr>
            <tr>
                <td>
                    PHP-FPM
                </td>
                <td>
                    87
                </td>
                <td>
                    3500
                </td>
                <td>
                    37.3
                </td>
                <td>
                    <a href="https://clck.ru/3Dbnig">
                        https://clck.ru/3Dbnig
                    </a>
                </td>
            </tr>
        </tbody>
    </table>
    <p>
        <img alt="" src="/upload/medialibrary/ad7/9stkwcrvd2z2hz93eag3fwcchylojaxn.png.webp"/>
    </p>
    <p>
        <em>
            Нагрузка на CPU
        </em>
    </p>
    <p>
        <img alt="" src="/upload/medialibrary/47f/colurl995la95r4bq970za6hr23yvng7.png.webp"/>
    </p>
    <p>
        <em>
            График использование памяти
        </em>
    </p>
    <p>
        <img alt="" src="/upload/medialibrary/780/vqrrw6rm39fte96898ss0aczqocf6buj.png.webp"/>
    </p>
    <p>
        <em>
            График времени ответа сервера
        </em>
    </p>
    <p>
        Для более корректного сравнения серверов стоит разделить их на две группы:
    </p>
    <ul>
        <li>
            Сервера, которые инициализируют приложение при каждом запросе: Apache mod_php, PHP-FPM, Nginx Unit.
        </li>
        <li>
            Сервера с долгоживущими процессами, которые загружают приложение один раз и продолжают с ним работать: FrankenPHP, Swoole, RoadRunner.
        </li>
    </ul>
    <p>
        В первой группе (Apache mod_php, PHP-FPM, Nginx Unit) разница в RPS незначительна. Однако PHP-FPM и Nginx Unit более эффективны в плане использования ресурсов.
    </p>
    <p>
        В тестах часто сравнивают PHP-FPM и mod_php, используя статичные данные (например, вывод phpinfo). В таких случаях PHP-FPM действительно демонстрирует прирост производительности в 300%+, что актуально только для статичных данных.
    </p>
    <p>
        Примеры тестирования вывода phpinfo:
    </p>
    <ul>
        <li>
            PHP-FPM –
            <a href="https://clck.ru/3DeQ32">
                https://clck.ru/3DeQ32
            </a>
        </li>
        <li>
            Apache+mod_php –
            <a href="https://clck.ru/3DeQbP">
                https://clck.ru/3DeQbP
            </a>
        </li>
    </ul>
    <p>
        Время ответа от сервера в случае с Apache возрастает до 8 сек. В то время как PHP-FPM стабильно отдает страницы за 200-300 мс.
    </p>
    <p>
        <img alt="" src="/upload/medialibrary/9a9/lhvb2o0ml3kurkvo908io3k52qqgtlbf.png.webp"/>
    </p>
    <p>
        <em>
            Результат тестирования phpinfo с Apache+mod_php
        </em>
    </p>
    <p>
        <img alt="" src="/upload/medialibrary/372/jm6fi3fvxkfq0bx3dvxd0vp3fzzz4cz7.png.webp"/>
    </p>
    <p>
        <em>
            Результат тестирования phpinfo с PHP-FPM
        </em>
    </p>
    <p>
        Тестирование сложных приложений, таких как Bagisto, показывает, что при динамических нагрузках разница между PHP-FPM и mod_php минимальна.
    </p>
    <p>
        Во второй группе (FrankenPHP, Swoole, RoadRunner) — долгоживущие процессы. Они обеспечивают существенное снижение потребления ресурсов и значительный прирост RPS по сравнению с первой группой. Однако важно учитывать, что приложение должно быть адаптировано для работы с серверами, которые загружаются в память один раз и продолжают функционировать без повторной инициализации.
    </p>
    <p>
        <strong>
            Сообщество и поддержка
        </strong>
    </p>
    <p>
        Приложения, такие как Swoole, RoadRunner, FrankenPHP и Nginx Unit, пользуются активной поддержкой сообщества разработчиков. Давайте сравним уровень этой поддержки.
    </p>
    <table>
        <thead>
            <tr>
                <th>
                </th>
                <th>
                </th>
                <th>
                </th>
                <th>
                </th>
                <th>
                </th>
                <th>
                </th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>
                    Сервер
                </td>
                <td>
                    Количество звезд
                </td>
                <td>
                    Количество мейнтейнеров
                </td>
                <td>
                    Количество релизов (за год)
                </td>
                <td>
                    Количество созданных issue (за год)
                </td>
                <td>
                    Процент закрытых issue
                </td>
            </tr>
            <tr>
                <td>
                    <a href="http://github.com/swoole/swoole-src">
                        Swoole
                    </a>
                </td>
                <td>
                    18.4k
                </td>
                <td>
                    151
                </td>
                <td>
                    5
                </td>
                <td>
                    207
                </td>
                <td>
                    95
                </td>
            </tr>
            <tr>
                <td>
                    <a href="http://github.com/roadrunner-server/roadrunner/">
                        RoadRunner
                    </a>
                </td>
                <td>
                    7.9k
                </td>
                <td>
                    53
                </td>
                <td>
                    20
                </td>
                <td>
                    112
                </td>
                <td>
                    74
                </td>
            </tr>
            <tr>
                <td>
                    <a href="http://github.com/dunglas/frankenphp">
                        FrankenPHP
                    </a>
                </td>
                <td>
                    6.8k
                </td>
                <td>
                    83
                </td>
                <td>
                    20
                </td>
                <td>
                    366
                </td>
                <td>
                    73
                </td>
            </tr>
            <tr>
                <td>
                    <a href="http://github.com/nginx/unit">
                        Nginx Unit
                    </a>
                </td>
                <td>
                    5.4k
                </td>
                <td>
                    46
                </td>
                <td>
                    7
                </td>
                <td>
                    236
                </td>
                <td>
                    61
                </td>
            </tr>
        </tbody>
    </table>
    <h2>
        Выводы
    </h2>
    <ul>
        <li>
            Apache mod_php лучше использовать вместе с Nginx в качестве сервера для статики в проектах где нет серьезных нагрузок и ничего не хочется конфигурировать.
        </li>
        <li>
            PHP-FPM оптимален для большинства стандартных и даже высоконагруженных проектов благодаря широкому использованию и активной поддержке сообщества.
        </li>
        <li>
            NGINX Unit обеспечивает производительность, близкую к PHP-FPM, но обладает дополнительными преимуществами — поддержка нескольких языков и возможность запуска нескольких серверов, что делает его отличным выбором для микросервисных архитектур.
        </li>
    </ul>
    <p>
        Swoole, FrankenPHP и RoadRunner хорошо подходят для высоконагруженных и асинхронных приложений, позволяя использовать долгоживущие процессы и снижая накладные расходы на инициализацию приложения. Однако такие решения требуют, чтобы приложение было адаптировано к работе с долгоживущими процессами. Из трех решений Swoole выделяется как наиболее популярное в сообществе и демонстрирует лучшую производительность и более низкое потребление ресурсов в наших тестах.
    </p>
    <p>
        Оцените статью
    </p>
    <p>
        Empty
    </p>
    <p>
        14.11.2024
    </p>
    <p>
        Понравилась статья?
    </p>
    <p>
        Поделитесь ссылкой с друзьями и коллегами!
    </p>
    <h3>
        Статьи по теме
    </h3>
    <p>
        <img alt="" src="https://www.intervolga.ru/upload/resize_cache/iblock/72c/470_200_2/tuyd87zdorzwitrgbiy23e0tjwvelto6.jpg.webp?w=1920"/>
    </p>
    <p>
        <a href="/blog/projects/sistema-loyalnosti-v-b2b-prodazhakh-kak-sozdat-i-budut-li-rezultaty/">
            Система лояльности в B2B-продажах: как создать и будут ли результаты
        </a>
        В B2B-продажах клиенты ищут не просто продукт, а партнера, который поможет им решить их бизнес-проблемы. Привлечение и удержание клиентов — одна из ...
    </p>
    <p>
        <img alt="" src="https://www.intervolga.ru/upload/resize_cache/iblock/43e/470_200_2/uxp2ez5pt78085puvl640v09dvz35svc.jpg.webp?w=1920"/>
    </p>
    <p>
        <a href="/blog/projects/sozdaem-kontent-khab-na-pimcore/">
            Создаем контент-хаб товарных данных на Pimcore
        </a>
        Наступит день, когда ваши 1С или БД сайта перестанут справляться с возросшим объемом товарного медиаконтента. Рассказываем как организовать правильное хранение ...
    </p>
    <p>
        <img alt="" src="https://www.intervolga.ru/upload/resize_cache/iblock/a25/470_200_2/xgq29ifcvq6w7lq5imutud99rsgffjx9.png.webp?w=1920"/>
    </p>
    <p>
        <a href="/blog/projects/organizatsiya-poiska-na-sayte-vybiraem-mezhdu-poiskom-bitriksa-sphinx-i-elasticsearch/">
            Организация поиска на сайте: выбираем между поиском Битрикса, Sphinx и Elasticsearch
        </a>
        В статье разбираем популярные поисковые движки, чтобы выбрать лучший под задачи конкретного проекта. Даем советы по индексации каталога и построении «умного» фи...
    </p>
    <p>
        <img alt="" src="https://www.intervolga.ru/upload/resize_cache/iblock/425/470_200_2/yz9mn3dr07ihnc5uhatfgvjn911yq80c.jpg.webp?w=1920"/>
    </p>
    <p>
        <a href="/blog/projects/dorabotka-sistemy-lms-knomary/">
            Доработка системы LMS Knomary
        </a>
        Must have для бизнеса, где главный актив это люди, — стратегия обучения и развития персонала. Рассказываем как помогли доработать LMS-систему для компании ЕВРАЗ...
    </p>
    <p>
        <img alt="" src="https://www.intervolga.ru/upload/resize_cache/iblock/fb0/470_200_2/fci6sf0g1flr0qjsxk9ao4x1232kuihb.png.webp?w=1920"/>
    </p>
    <p>
        <a href="/blog/projects/kak-ranshe-bolshe-ne-rabotaet-b2b-sistema-prodazh-seychas/">
            «Как раньше» больше не работает — B2B-система продаж сейчас
        </a>
        В этой статье хотим поговорить с чем сейчас сталкивается оптовый бизнес (множеством вызовов и изменений, которые требуют адаптации, а также оптимизации процессо...
    </p>
    <p>
        Мы работаем по одному из двух форматов:
    </p>
    <ul>
        <li>
            аренда команды (от 2 человек, не менее 3 месяцев);
        </li>
        <li>
            итерации с фиксированной ценой (1-3 месяца длительностью).
        </li>
    </ul>
    <p>
        ИНТЕРВОЛГА предоставляет:
    </p>
    <ul>
        <li>
            регулярные онлайн-планерки с заказчиком;
        </li>
        <li>
            квалифицированных специалистов;
        </li>
        <li>
            организованную команду (находятся в одном помещении, что упрощает решение рабочих вопросов);
        </li>
        <li>
            полную прозрачность и регулярность отчетов о результатах.
        </li>
    </ul>
    <p>
        Ключевые услуги:
    </p>
    <ul>
        <li>
            нагруженный интернет-магазин;
        </li>
        <li>
            личный кабинет;
        </li>
        <li>
            оптовые продажи — B2B-платформа;
        </li>
        <li>
            маркетплейс;
        </li>
        <li>
            технический аудит сайта;
        </li>
        <li>
            Битрикс24 — корпоративные HR-порталы;
        </li>
        <li>
            Битрикс24 — построение CRM-системы;
        </li>
        <li>
            Битрикс24 — личные кабинеты сотрудников;
        </li>
        <li>
            Битрикс24 — аудит портала;
        </li>
        <li>
            1С — интеграция с другими системами;
        </li>
        <li>
            1С — доработка системы;
        </li>
        <li>
            маркетинг — комплексное интернет-продвижение;
        </li>
        <li>
            маркетинг — продвижение для B2B.
        </li>
    </ul>
    <p>
        Хотите получать лучшие статьи от INTERVOLGA раз в месяц?
    </p>
    <p>
        Подпишитесь на рассылку — спамить не будем
    </p>
    <p>
        <a href="/">
            <img alt="intervolga.ru" src="/assets/logo/white.svg"/>
        </a>
    </p>
    <ul>
        <li>
            <p>
                <a href="/">
                    Москва
                </a>
            </p>
        </li>
        <li>
            <p>
                <a href="/volgograd/">
                    Волгоград
                </a>
            </p>
        </li>
        <li>
            <p>
                <a href="/drugoe/rostov/">
                    Ростов
                </a>
            </p>
        </li>
        <li>
            <p>
                <a href="/contacts/">
                    Контакты
                </a>
            </p>
        </li>
        <li>
            <p>
                <a href="tel:+7 495 648 57 90">
                    +7 495 648 57 90
                </a>
            </p>
        </li>
        <li>
            <p>
                <a href="tel:+7 844 295 99 99">
                    +7 844 295 99 99
                </a>
            </p>
        </li>
        <li>
            <p>
                <a href="mailto:info@intervolga.ru">
                    info@intervolga.ru
                </a>
            </p>
        </li>
    </ul>
    <p>
        © 2003-2025, интернет-агентство INTERVOLGA
    </p>
    <p>
        <a href="/privacy/">
            Политика конфиденциальности
        </a>
    </p>
</body>